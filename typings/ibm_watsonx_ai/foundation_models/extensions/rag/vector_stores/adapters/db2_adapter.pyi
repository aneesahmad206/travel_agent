"""
This type stub file was generated by pyright.
"""

from typing import Any, TypeAlias
from langchain_core.documents import Document
from ibm_watsonx_ai import APIClient
from ibm_watsonx_ai.foundation_models.embeddings import BaseEmbeddings
from ibm_watsonx_ai.foundation_models.extensions.rag.vector_stores.langchain_vector_store_adapter import LangChainVectorStoreAdapter
from ibm_watsonx_ai.utils.utils import is_lib_installed
from langchain_core.embeddings import Embeddings as LCEmbeddings
from langchain_db2 import DB2VS

if not is_lib_installed(ext := "langchain-db2"):
    ...
logger = ...
EmbeddingType: TypeAlias = BaseEmbeddings | LCEmbeddings
class DB2VectorStore(LangChainVectorStoreAdapter):
    """DB2VectorStore vector store client for a RAG pattern.

    :param api_client: api client is required if connecting by connection_id, defaults to None
    :type api_client: APIClient, optional

    :param connection_id: connection asset ID, defaults to None
    :type connection_id: str, optional

    :param vector_store: initialized langchain_db2 vector store, defaults to None
    :type vector_store: langchain_db2.DB2VS, optional

    :param embedding_function: dense embedding function, defaults to None
    :type embedding_function: BaseEmbeddings | LCEmbeddings, optional

    :param table_name: name of the DB2 table name, defaults to None
    :type table_name: str, optional

    :param document_name_field: mapping field for document name, defaults to `document_id`
    :type document_name_field: str, optional

    :param chunk_sequence_number_field: mapping field for chunk sequence number, defaults to `sequence_number`
    :type chunk_sequence_number_field: str, optional

    :param text_field: mapping field for text field
    :type text_field: str, optional

    :param kwargs: keyword arguments that will be directly passed to `langchain_db2.DB2VS` constructor
    :type kwargs: Any, optional

    **Example:**

    To connect, provide the connection asset ID.
    You can use custom embeddings to add and search documents.

    .. code-block:: python

        from ibm_watsonx_ai import APIClient, Credentials
        from ibm_watsonx_ai.foundation_models.extensions.rag.vector_stores import (
            DB2VectorStore,
        )
        from ibm_watsonx_ai.foundation_models.embeddings import Embeddings

        credentials = Credentials(
            api_key=IAM_API_KEY, url="https://us-south.ml.cloud.ibm.com"
        )

        api_client = APIClient(credentials, project_id="<PROJECT_ID>")

        embedding = Embeddings(
            model_id=EmbeddingTypes.IBM_SLATE_30M_ENG, api_client=api_client
        )

        vector_store = DB2VectorStore(
            api_client,
            connection_id="***",
            collection_name="my_test_collection",
            embedding_function=embedding,
        )

        vector_store.add_documents(
            [
                {
                    "content": "document one content",
                    "metadata": {"url": "ibm.com"},
                },
                {
                    "content": "document two content",
                    "metadata": {"url": "ibm.com"},
                },
            ]
        )
        # ['4CDDAF00329B3DF9', 'B8AE97421A8857E7']

        vector_store.search("one", k=1)
        # [Document(metadata={'url': 'ibm.com'}, page_content='document one content')]

    """
    def __init__(self, api_client: APIClient | None = ..., *, connection_id: str | None = ..., vector_store: DB2VS | None = ..., embedding_function: EmbeddingType | None = ..., table_name: str | None = ..., document_name_field: str = ..., chunk_sequence_number_field: str = ..., text_field: str | None = ..., **kwargs: Any) -> None:
        ...
    
    def get_client(self) -> DB2VS:
        """Get langchain_db2.DB2VS instance."""
        ...
    
    def clear(self) -> None:
        """
        Clear table by removing all records.
        """
        ...
    
    def count(self) -> int:
        """
        Count number of records in table.
        """
        ...
    
    def add_documents(self, content: list[str] | list[dict] | list[Document], **kwargs: Any) -> list[str]:
        """
        Embed documents and add to the vectorstore.

        :param content: Documents to add to the vectorstore.
        :type content: list[str] | list[dict] | list[langchain_core.documents.Document]

        :return: List of IDs of the added texts.
        :rtype: list[str]
        """
        ...
    
    def to_dict(self) -> dict:
        """Serialize ``DB2VectorStore`` into a dict that allows reconstruction using the ``from_dict`` class method.

        :return: dict for the from_dict initialization
        :rtype: dict

        :raises VectorStoreSerializationError: when instance is not serializable
        """
        ...
    
    @classmethod
    def from_dict(cls, api_client: APIClient | None = ..., data: dict | None = ...) -> DB2VectorStore:
        """Creates ``DB2VectorStore`` using only a primitive data type dict.

        :param api_client: initialised APIClient used in vector store constructor, defaults to None
        :type api_client: APIClient, optional

        :param data: dict in schema like the ``to_dict()`` method
        :type data: dict

        :return: reconstructed DB2VectorStore
        :rtype: DB2VectorStore
        """
        ...
    


