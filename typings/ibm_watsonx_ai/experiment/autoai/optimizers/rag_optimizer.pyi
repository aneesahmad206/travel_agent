"""
This type stub file was generated by pyright.
"""

from pathlib import Path
from typing import Any, TYPE_CHECKING
from pandas import DataFrame
from ibm_watsonx_ai.foundation_models.schema import AutoAIRAGCustomModelConfig, AutoAIRAGDeploymentConfig, AutoAIRAGGenerationConfig, AutoAIRAGModelConfig, AutoAIRAGRetrievalConfig
from ibm_watsonx_ai.helpers.connections import DataConnection
from ibm_watsonx_ai.utils.autoai.knowledge_base import BaseKnowledgeBase
from ibm_watsonx_ai.experiment.autoai.engines import RAGEngine
from ibm_watsonx_ai.foundation_models.extensions.rag.pattern import RAGPattern

if TYPE_CHECKING:
    ...
__all__ = ["RAGOptimizer"]
class RAGOptimizer:
    """RAGOptimizer class for RAG pattern operation.

    :param name: name for the RAGOptimizer
    :type name: str

    :param engine: engine for remote work on Service instance
    :type engine: RAGEngine

    :param description: description for the RAGOptimizer
    :type description: str, optional

    :param embedding_models: The embedding models to try.
    :type embedding_models: list[str], optional

    :param retrieval_methods: Retrieval methods to be used.
    :type retrieval_methods: list[str], optional

    :param foundation_models: List of foundation models to try. Custom foundation models and model config are also supported for Cloud and CPD >= 5.2.
    :type foundation_models: list[str | dict | AutoAIRAGModelConfig | AutoAIRAGCustomModelConfig], optional

    :param max_number_of_rag_patterns: The maximum number of RAG patterns to create.
    :type max_number_of_rag_patterns: int, optional

    :param optimization_metrics: The metric name(s) to be used for optimization.
    :type optimization_metrics: list[str], optional

    :param generation: Properties describing the generation step.
    :type generation: dict[str, Any] | AutoAIRAGGenerationConfig, optional

    :param retrieval: Retrieval settings to be used.
    :type retrieval: list[dict[str, Any] | AutoAIRAGRetrievalConfig], optional

    :param deployment: Best pattern deployment related properties.
    :type deployment: dict[str, Any] | AutoAIRAGDeploymentConfig, optional
    """
    def __init__(self, name: str, engine: RAGEngine, description: str | None = ..., chunking_methods: list[str] | None = ..., embedding_models: list[str] | None = ..., retrieval_methods: list[str] | None = ..., foundation_models: (list[str | dict | AutoAIRAGModelConfig | AutoAIRAGCustomModelConfig] | None) = ..., max_number_of_rag_patterns: int | None = ..., optimization_metrics: list[str] | None = ..., chunking: list[dict] | None = ..., generation: dict[str, Any] | AutoAIRAGGenerationConfig | None = ..., retrieval: list[dict[str, Any] | AutoAIRAGRetrievalConfig] | None = ..., deployment: dict[str, Any] | AutoAIRAGDeploymentConfig | None = ..., **kwargs: dict[str, Any]) -> None:
        ...
    
    def get_params(self) -> dict:
        """Get configuration parameters of RAGOptimizer.

        :return: RAGOptimizer parameters
        :rtype: dict

        **Example**

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)

            rag_optimizer.get_params()

            # Result:
            # {
            #     'name': 'RAG AutoAi ',
            #     'description': 'Sample description',
            #     'max_number_of_rag_patterns': 5,
            #     'optimization_metrics': ['answer_correctness']
            # }

        """
        ...
    
    def run(self, input_data_references: list[DataConnection] | None = ..., test_data_references: list[DataConnection] | None = ..., results_reference: DataConnection | None = ..., vector_store_references: list[DataConnection] | None = ..., background_mode: bool = ..., knowledge_base_references: list[BaseKnowledgeBase] | None = ...) -> dict:
        """Create an AutoAI RAG job that will find the best RAG pattern.

        :param input_data_references: data storage connection details to inform where training data is stored
        :type input_data_references: list[DataConnection]

        :param test_data_references: a set of test data references
        :type test_data_references: list[DataConnection], optional

        :param results_reference: the training results
        :type results_reference: DataConnection, optional

        :param vector_store_references: set of vector store references
        :type vector_store_references: list[DataConnection], optional

        :param background_mode: indicator if run() method will run in background (async) or (sync)
        :type background_mode: bool, optional

        :param knowledge_base_references: collection of knowledge base references
        :type knowledge_base_references: list[BaseKnowledgeBase], optional

        :return: run details
        :rtype: dict

        **Examples**

        Example with input data references:

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI
            from ibm_watsonx_ai.utils.autoai.enums import TShirtSize
            from ibm_watsonx_ai.helpers import DataConnection, ContainerLocation

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)

            rag_optimizer.run(
                input_data_references=[
                    DataConnection(data_asset_id=training_data_asset_id),
                ],
                test_data_references=[
                    DataConnection(data_asset_id=test_data_asset_id),
                ],
                vector_store_references=[
                    DataConnection(connection_asset_id=milvus_connection_id),
                ],
                results_reference=[
                    DataConnection(location=ContainerLocation(path=".")),
                ],
                background_mode=False,
            )

        Example with vector store knowledge base references:

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI
            from ibm_watsonx_ai.utils.autoai.enums import TShirtSize
            from ibm_watsonx_ai.utils.autoai.knowledge_base import (
                VectorStoreKnowledgeBase,
            )
            from ibm_watsonx_ai.helpers import DataConnection, ContainerLocation

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)

            vector_store_knowledge_bases = [VectorStoreKnowledgeBase(...), ...]

            rag_optimizer.run(
                knowledge_base_references=vector_store_knowledge_bases,
                test_data_references=[
                    DataConnection(data_asset_id=test_data_asset_id),
                ],
                results_reference=[
                    DataConnection(location=ContainerLocation(path=".")),
                ],
                background_mode=False,
            )

        Example with SQL database knowledge base references:

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI
            from ibm_watsonx_ai.utils.autoai.enums import TShirtSize
            from ibm_watsonx_ai.utils.autoai.knowledge_base import (
                DatabaseKnowledgeBase,
            )
            from ibm_watsonx_ai.helpers import DataConnection, ContainerLocation

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)

            database_knowledge_bases = [DatabaseKnowledgeBase(...), ...]

            rag_optimizer.run(
                knowledge_base_references=database_knowledge_bases,
                test_data_references=[
                    DataConnection(data_asset_id=test_data_asset_id),
                ],
                results_reference=[
                    DataConnection(location=ContainerLocation(path=".")),
                ],
                background_mode=False,
            )
        """
        ...
    
    def cancel_run(self, hard_delete: bool = ...) -> str:
        """Cancels a RAG Optimizer run.

        :param hard_delete: specify `True` or `False`:

            * `True` - to delete the completed or canceled training run
            * `False` - to cancel the currently running training run
        :type hard_delete: bool, optional

        :return: status "SUCCESS" if cancellation is successful
        :rtype: str

        **Example**

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)
            rag_optimizer.run(...)

            rag_optimizer.cancel_run()
            # or
            rag_optimizer.cancel_run(hard_delete=True)

        """
        ...
    
    def get_run_status(self) -> str:
        """Check status/state of initialized RAGOptimizer run if ran in background mode.

        :return: run status details
        :rtype: str

        **Example**

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)

            rag_optimizer.get_run_status()

            # Result:
            # 'completed'

        """
        ...
    
    def get_run_details(self) -> dict:
        """Get run details.

        :return: RAGOptimizer run details
        :rtype: dict

        **Example**

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)

            rag_optimizer.get_run_details()

        """
        ...
    
    def summary(self, scoring: str | list[str] | None = ...) -> DataFrame:
        """Return RAGOptimizer summary details.

        :param scoring: scoring metric which user wants to use to sort patterns by,
            when not provided use optimized one
        :type scoring: str | list, optional

        :return: computed patterns and metrics
        :rtype: pandas.DataFrame

        **Example**

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)

            rag_optimizer.summary()
            rag_optimizer.summary(scoring="answer_correctness")
            rag_optimizer.summary(
                scoring=["answer_correctness", "context_correctness"]
            )

            # Result:
            #                  mean_answer_correctness  ...  ci_high_faithfulness
            # Pattern_Name	                            ...
            # Pattern5                        0.79165   ...                0.5102
            # Pattern1                        0.72915   ...                0.4839
            # Pattern2                        0.64585   ...                0.8333
            # Pattern4                        0.64585   ...                0.5312

        """
        ...
    
    def get_pattern(self, pattern_name: str | None = ...) -> RAGPattern:
        """Return RAGPattern from RAGOptimizer training.

        :param pattern_name: pattern name, if you want to see the patterns names, please use summary() method,
            if this parameter is None, the best pattern will be fetched
        :type pattern_name: str, optional

        :return: RAGPattern class for defining, querying and deploying Retrieval-Augmented Generation (RAG) patterns.
        :rtype: RAGPattern

        **Example**

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)

            pattern_1 = rag_optimizer.get_pattern()
            pattern_2 = rag_optimizer.get_pattern(pattern_name="Pattern2")

        """
        ...
    
    def get_pattern_details(self, pattern_name: str | None = ...) -> dict:
        """Fetch specific pattern details, e.g. steps etc.

        :param pattern_name: pattern name e.g. Pattern1, if not specified, best pattern parameters will be fetched
        :type pattern_name: str, optional

        :return: pattern parameters
        :rtype: dict

        **Example**

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)

            rag_optimizer.get_pattern_details()
            rag_optimizer.get_pattern_details(pattern_name="Pattern1")

        """
        ...
    
    def get_inference_notebook(self, *, pattern_name: str | None = ..., local_path: str | Path = ..., filename: str | None = ...) -> str:
        """Download specified inference notebook from Service.

        :param pattern_name: pattern name, if you want to see the patterns names, please use summary() method,
            if this parameter is None, the best pattern will be fetched
        :type pattern_name: str, optional

        :param local_path: local filesystem path, if not specified, current directory is used
        :type local_path: str | Path, optional

        :param filename: filename under which the pattern notebook will be saved
        :type filename: str, optional

        :return: path to saved inference notebook
        :rtype: str

        **Example**

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)

            inference_notebook_path_1 = rag_optimizer.get_inference_notebook()
            inference_notebook_path_2 = rag_optimizer.get_inference_notebook(
                pattern_name="Pattern1", filename="inference_notebook"
            )

        """
        ...
    
    def get_indexing_notebook(self, *, pattern_name: str | None = ..., local_path: str | Path = ..., filename: str | None = ...) -> str:
        """Download specified indexing notebook from Service.

        :param pattern_name: pattern name, if you want to see the patterns names, please use summary() method,
            if this parameter is None, the best pattern will be fetched
        :type pattern_name: str, optional

        :param local_path: local filesystem path, if not specified, current directory is used
        :type local_path: str | Path, optional

        :param filename: filename under which the pattern notebook will be saved
        :type filename: str, optional

        :return: path to saved indexing notebook
        :rtype: str

        **Example**

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)

            indexing_notebook_path_1 = rag_optimizer.get_indexing_notebook()
            indexing_notebook_path_2 = rag_optimizer.get_indexing_notebook(
                pattern_name="Pattern1", filename="indexing_notebook"
            )

        """
        ...
    
    def get_logs(self) -> str:
        """
        Get logs of an AutoAI RAG job

        return: path to saved logs
        :rtype: str

        **Example**

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)

            rag_optimizer.get_logs()

        """
        ...
    
    def get_evaluation_results(self, pattern_name: str | None = ...) -> str:
        """
        Get evaluation results of an AutoAI RAG job

        :param pattern_name: pattern name, if you want to see the patterns names, please use summary() method,
            if this parameter is None, the best pattern will be fetched
        :type pattern_name: str, optional

        return: path to saved evaluation results
        :rtype: str

        .. code-block:: python

            from ibm_watsonx_ai.experiment import AutoAI

            experiment = AutoAI(credentials, ...)
            rag_optimizer = experiment.rag_optimizer(...)

            rag_optimizer.get_evaluation_results()
            # or
            rag_optimizer.get_evaluation_results(pattern_name="Pattern1")

        """
        ...
    


